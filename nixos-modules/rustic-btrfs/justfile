#!/usr/bin/env -S just --justfile

set fallback := true

PROJECT := "rustic-btrfs"

alias fmt := format
alias lint := check

_:
    @just --list

build:
    nix --quiet --log-format raw --no-warn-dirty build '.#{{ PROJECT }}'

test:
    @echo "Running library unit tests..."
    @cargo --quiet test --lib
    @echo ""
    @echo "Note: Integration tests require Nix devShell (provides libbtrfsutil)"
    @echo "Run 'just test-integration' inside 'nix develop' to run them"

test-integration:
    @echo "Running integration tests (requires devShell)..."
    @cargo --quiet test --test workflow_test --test lock_test

check:
    cargo --quiet clippy

format:
    cargo --quiet clippy --fix 2>/dev/null | true
    cargo --quiet fmt --all
